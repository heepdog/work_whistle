<!DOCTYPE html>
<html>
<head>
  <meta name="viewport" content="width=device-width, initial-scale=1">  <title>ESP8266 Websocket</title>
  <link rel="stylesheet" href="/styles.css">
  <script language="javascript">
   function check(element) {
     console.log(element.id);
     var msg = { command: "DigitalWrite", pin: element.id, data: element.checked?1:0 , date: Date.now()}
     if (webSocket.readyState == WebSocket.CLOSED){
       webSocket = new WebSocket(gwUrl);
     }

      webSocket.send(JSON.stringify(msg));
    }

    var gwUrl = "ws://" + location.host + "/ws";
    var webSocket = new WebSocket(gwUrl);
    webSocket.onopen = function(e) {
        console.log("open");
        document.getElementById("databox").classList.remove("disabledbutton");
    }
    webSocket.onclose = function(e) {
        //document.getElementById("databox").classList.add("disabledbutton");
        console.log("close");
        webSocket = new WebSocket(gwUrl);
    }
  
    webSocket.onmessage = function(e) {
      console.log("message");
      var data = e.data;
      var jsondata = JSON.parse(data);
      if(jsondata.command == "message"){
        var newLine = document.createElement("P");
        newLine.className = "ConsoleLine"
        var newMessage = document.createTextNode(e.data);
        newLine.appendChild(newMessage);
        document.getElementById("messagebox").appendChild(newLine);
        document.getElementById("messagebox").lastElementChild.scrollIntoView(false);
      }
      else if(jsondata.command == "update")
        document.getElementById(jsondata.pin).checked = jsondata.value=="1"?true:false;
      //if (data == '1')
        //document.getElementById('s1').checked = true;
      //else
       //document.getElementById('s1').checked = false;
    }
 </script>
  


</head>
<body>
  <h2>ESP8266 Websocket</h2>
  <div class="content disabledbutton" id="databox" disabled >
     <p><h4>Turn on Led</h4>
     <label class="switch">
        <input type="checkbox" id="s1" onchange="check(this)" />
        <span class="slider round"></span>
     </label>
   </p>
     <p><h4>Turn on D4</h4>
     <label class="switch">
        <input type="checkbox" id="D4" onchange="check(this)" />
        <span class="slider round"></span>
     </label>
   </p>
   <p><h4>Turn on D3</h4>
    <label class="switch">
       <input type="checkbox" id="D3" onchange="check(this)" />
       <span class="slider round"></span>
    </label>
  </p>
  <p><h4>Turn on D2</h4>
    <label class="switch">
       <input type="checkbox" id="D2" onchange="check(this)" />
       <span class="slider round"></span>
    </label>
  </p>
</div>

  <div class="content console" id="messagebox">
  </div>

</body>
</html>